
Ôªø@using Services.Service
@using Microsoft.AspNetCore.Components.Authorization
@using Services.Service
@inherits LayoutComponentBase
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation


<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>

        <AuthorizeView>
            <Authorized>
                <button class="auth-button logout-button" @onclick="HandleLogout">Logout</button>
            </Authorized>
            <NotAuthorized>
                <a href="/login" class="auth-button login-button">Login</a>
                <a href="/register" class="auth-button register-button">Register</a>
            </NotAuthorized>
        </AuthorizeView>


        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">üóô</a>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            Console.WriteLine("OnAfterRenderAsync: Initializing auth state...");
            var customAuthStateProvider = (CustomAuthStateProvider)AuthStateProvider;
            await customAuthStateProvider.InitializeAsync();
            StateHasChanged();
        }
    }

    private async Task HandleLogout()
    {
        Console.WriteLine("HandleLogout: Logging out...");
        var customAuthStateProvider = (CustomAuthStateProvider)AuthStateProvider;
        await customAuthStateProvider.LogoutAsync();
        Navigation.NavigateTo("/login");
    }
}

<style>
    .page {
        display: flex;
        flex-direction: row;
        min-height: 100vh;
        background: linear-gradient(135deg, #f0f4ff, #e2e8f0); /* Gradient n·ªÅn nh·∫π */
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Font hi·ªán ƒë·∫°i */
    }


    /* Sidebar */
    .sidebar {
        width: 250px;
        background: #1e293b; /* M√†u t·ªëi cho sidebar */
        flex-shrink: 0;
        box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2); /* Th√™m b√≥ng ƒë·ªï */
        transition: width 0.3s ease; /* Hi·ªáu ·ª©ng khi thay ƒë·ªïi k√≠ch th∆∞·ªõc */
    }


    /* Main content */
    main {
        flex: 1;
        background: #ffffff; /* N·ªÅn tr·∫Øng s·∫°ch */
        padding: 20px;
        border-radius: 12px; /* Bo g√≥c nh·∫π */
        margin: 20px; /* Kho·∫£ng c√°ch v·ªõi sidebar */
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); /* B√≥ng ƒë·ªï nh·∫π */
    }

    /* N√∫t chung */

    .auth-button {
        padding: 10px 20px; /* TƒÉng padding cho n√∫t l·ªõn h∆°n */
        border-radius: 25px; /* Bo g√≥c tr√≤n h∆°n */
        text-decoration: none;
        font-weight: 700; /* ƒê·∫≠m h∆°n */
        font-size: 1rem;
        text-transform: uppercase; /* Ch·ªØ in hoa */
        letter-spacing: 0.5px; /* Kho·∫£ng c√°ch ch·ªØ */
        display: inline-flex; /* CƒÉn gi·ªØa n·ªôi dung */
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease-in-out; /* Hi·ªáu ·ª©ng m∆∞·ª£t m√† */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* B√≥ng ƒë·ªï nh·∫π */
        margin: 0 10px 10px 0; /* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
    }


    /* N√∫t Login */
    .login-button {
        background: linear-gradient(45deg, #ff6b6b, #ff8e53); /* Gradient ƒë·∫πp h∆°n */

        color: #ffffff;
    }


    .login-button:hover {
        background: linear-gradient(45deg, #ff8e53, #ff6b6b); /* ƒê·∫£o gradient khi hover */
        transform: translateY(-2px); /* N√¢ng l√™n khi hover */
        box-shadow: 0 6px 15px rgba(255, 107, 107, 0.4); /* B√≥ng ƒë·ªï n·ªïi b·∫≠t */
    }

    /* N√∫t Register */
    .register-button {
        background: linear-gradient(45deg, #4b6cb7, #182848); /* Gradient xanh d∆∞∆°ng */
        color: #ffffff;
    }

    .register-button:hover {
        background: linear-gradient(45deg, #182848, #4b6cb7); /* ƒê·∫£o gradient khi hover */
        transform: translateY(-2px); /* N√¢ng l√™n khi hover */
        box-shadow: 0 6px 15px rgba(75, 108, 183, 0.4); /* B√≥ng ƒë·ªï n·ªïi b·∫≠t */
    }

    /* N√∫t Logout */
    .logout-button {
        background: linear-gradient(45deg, #e53e3e, #9b2c2c); /* Gradient ƒë·ªè */
        color: #ffffff;
        border: none; /* Lo·∫°i b·ªè border m·∫∑c ƒë·ªãnh c·ªßa button */
        cursor: pointer;
    }

    .logout-button:hover {
        background: linear-gradient(45deg, #9b2c2c, #e53e3e); /* ƒê·∫£o gradient khi hover */
        transform: translateY(-2px); /* N√¢ng l√™n khi hover */
        box-shadow: 0 6px 15px rgba(229, 62, 62, 0.4); /* B√≥ng ƒë·ªï n·ªïi b·∫≠t */
    }

    .content {
        padding: 1.5rem; /* TƒÉng padding cho tho√°ng */
        background: #f9fafb; /* N·ªÅn x√°m nh·∫°t */
        border-radius: 8px; /* Bo g√≥c nh·∫π */
        min-height: calc(100vh - 100px); /* ƒê·∫£m b·∫£o chi·ªÅu cao ƒë·ªß */
    }


    /* Th√¥ng b√°o l·ªói */
    #blazor-error-ui {
        background: #fef2f2; /* N·ªÅn ƒë·ªè nh·∫°t m·ªÅm h∆°n */
        color: #dc2626;
        padding: 1rem;
        text-align: center;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        border-top: 2px solid #f87171; /* Vi·ªÅn tr√™n ƒë·ªè */
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); /* B√≥ng ƒë·ªï l√™n tr√™n */
        font-size: 0.95rem;
        z-index: 1000; /* ƒê·∫£m b·∫£o lu√¥n ·ªü tr√™n c√πng */
    }


    #blazor-error-ui .reload,
    #blazor-error-ui .dismiss {
        color: #dc2626;
        margin-left: 15px;
        text-decoration: none;
        font-weight: 600;
        transition: color 0.2s ease;
    }

    #blazor-error-ui .reload:hover,
    #blazor-error-ui .dismiss:hover {
        color: #b91c1c; /* ƒê·∫≠m h∆°n khi hover */
        text-decoration: underline;
    }
</style>